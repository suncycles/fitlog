import 'dart:async';
import 'exercise_class.dart';
import 'history_class.dart';
import 'workout_class.dart';
import 'database_helper.dart';

// All dummy functions. Replace with SQL queris
class WorkoutDatabase {
  static final WorkoutDatabase instance = WorkoutDatabase._init();
  WorkoutDatabase._init();

  Future<List<Exercise>> getExercises({String? primaryMuscle}) async {
    // Fetching exercises filtered by primaryMuscle
    final db = await DatabaseHelper.instance.database;

    String sql = 'SELECT exercise_id FROM exercist_list';
    List<dynamic> args = [];

    if (primaryMuscle != null) {
      sql += ' WHERE primary_muscles = ?';
      args.add(primaryMuscle);
    }

    final result = await db.rawQuery(sql, args);

    return result.map((row) => Exercise.fromMap(row)).toList();
    // SELECT exercise_id FROM exercise_list WHERE primary_muscles = primaryMuscle;
  }

  Future<int?> getExerciseID(String name) async {
    final db = await DatabaseHelper.instance.database;

    final result = await db.rawQuery ('SELECT exercise_id FROM exercise_list WHERE exercise_name = ?', [name]);

    if (result.isNotEmpty) {
      return result[0]['exercise_id'] as int;
    }
    else {
      return null;
    }
  
    // Getting the exercise_id from the name
    // SELECT exercise_id FROM exercise_list WHERE exercise_name = name;
    // Can change to exercise_name if needed
  }
  
  Future<Exercise?> getExercise(int id) {
    final db = await DatabaseHelper.instance.database;

    final result = await db.query('exercise_list', where: 'exercise_id = ?,[id]);
    
    if (result.isNotEmpty) {
      return Exercise.fromMap(result.first);
    }

    return null;

  }

  Future<int> createExercise(Exercise exercise) async {
    // Inserting new exercise into db
    // ignore for now
    return 1;
  }

  Future<List<String>> getPrimaryMuscles() async {
    // Fetching primary muscle groups
    // ignore for now
    return ['Chest', 'Back', 'Legs'];
  }
  
  Future<void> addExerciseToWorkout(String workoutName, int exerciseId, int numSets) async {
    // INSERT INTO workout_builder(workoutName, exerciseId, numSets)
    // Ask user name of workout when create new workout button pressed
    // Ask user number of sets they want to do when adding an exercise to workout
    //GOOD TO GO
    final db = await DatabaseHelper.instance.database;

    await db.insert('workout_builder', {'workout_name': workoutName, 'exercise_id': exerciseId, 'sets': numSets});
  }

  Future<List<Workout>> getWorkouts() async {
    // Fetching all workouts, just the names use getWorkout to pull up all info after clicking on it
    final db = await DatabaseHelper.instance.database;

    final result = await db.rawQuery('SELECT DISTINCT wokrout_name FROM workout_builder');


    return result.map((row) => row['workout_name'] as String).toList();
  }

  Future<List<Workout>> getWorkout(String workoutName) async {
    final db = await DatabaseHelper.instance.database;

    final result = await db.query ('workout_builder', where: 'workout_name = ?, [workoutName]);

    return result.map((row) -> Workout.fromJson(row)).toList();
    // Fetching workout with id
    // This gets all the exercise ids from a particular workout to be able to pull up any info we need
    // SELECT exercise_id FROM workout_builder WHERE workout_name = workoutName;
    return null; // possibly a list of exercises
  }

  Future<int> updateWorkout(Workout workout) async {
    // Updating workout by ID
    return 1;
  }

  Future<int> deleteWorkout(int id) async {
    // Deleting workout by ID
    return 1;
  }

  Future<int> createExerciseHistory(ExerciseHistory history) async {
    // Logging history for exercise
    return 1;
  }

  Future<List<ExerciseHistory>> getExerciseHistory(int workoutId) async {
    // Fetching history for workoutId
    return [];
  }

  Future<int> updateExerciseHistory(ExerciseHistory history) async {
    // Updating exercise history by ID
    return 1;
  }

  Future<int> deleteExerciseHistory(int id) async {
    // Deleting exercise history by ID
    return 1;
  }

  Future close() async {
    // Closing dummy database connection
  }
}
